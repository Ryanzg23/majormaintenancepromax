<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MAJOR MAINTENANCE PRO MAX</title>

<style>
* { box-sizing:border-box; }

body {
  margin:0;
  font-family:system-ui,sans-serif;
  background:#f5f5f5;
  color:#111;
}

.container {
  max-width:1200px;
  margin:auto;
  padding:16px;
}

header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
}

h1 { margin:0; font-size:20px; }

/* INPUT */
textarea {
  width:100%;
  min-height:160px;
  padding:12px;
  border-radius:8px;
  border:1px solid #ccc;
  resize:vertical;
}

/* BUTTONS */
button {
  padding:10px 14px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  background:#2563eb;
  color:#fff;
  font-weight:600;
  font-size:13px;
}

button:hover:not(:disabled) {
  transform:translateY(-1px);
  box-shadow:0 6px 18px rgba(0,0,0,.2);
}

button:disabled {
  opacity:.5;
  cursor:not-allowed;
}

.actions {
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-top:10px;
}

.card {
  background:#fff;
  padding:15px;
  border-radius:12px;
  margin-top:15px;
}

/* RESULTS GRID (REPORT PREVIEW) */
.report-grid {
  display:flex;
  flex-wrap:wrap;
  gap:16px;
  margin-top:20px;
}

.report-item {
  width:calc(50% - 8px);
  background:#fff;
  border:1px solid #ddd;
  border-radius:12px;
  padding:14px;
}

.report-item h3 {
  margin:0 0 10px 0;
  font-size:15px;
  word-break:break-all;
}

/* SITE PREVIEW */
.site-preview {
  position:relative;
  margin-bottom:12px;
}

.site-preview iframe {
  width:100%;
  height:280px;
  border:1px solid #ccc;
  border-radius:10px;
}

.preview-label {
  position:absolute;
  top:8px;
  left:8px;
  background:rgba(0,0,0,.75);
  color:#fff;
  font-size:12px;
  padding:5px 10px;
  border-radius:6px;
}

/* TABLE */
table {
  width:100%;
  border-collapse:collapse;
  font-size:12px;
  margin-bottom:12px;
}

th, td {
  border:1px solid #ccc;
  padding:6px;
}

th { background:#f0f0f0; }

/* ROBOTS / SITEMAP */
.code-block {
  background:#0f172a;
  color:#e5e7eb;
  padding:10px;
  border-radius:8px;
  font-size:11px;
  max-height:180px;
  overflow:auto;
  white-space:pre-wrap;
  margin-bottom:10px;
}

/* REPORT PAGE TOP BAR */
.report-toolbar {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:16px;
}

/* PRINT STYLES */
@media print {
  body { background:#fff; }
  .report-toolbar { display:none; }
  .report-item {
    width:100%;
    page-break-inside:avoid;
    break-inside:avoid;
  }
}

/* MOBILE */
@media (max-width:900px) {
  .report-item { width:100%; }
}
</style>
</head>

<body>
<div class="container">

<header>
  <h1>MAJOR MAINTENANCE PRO MAX</h1>
</header>

<div class="card">
<textarea id="urls" placeholder="One domain or URL per line"></textarea>

<div class="actions">
  <button onclick="runSEO()">GENERATE META + ROBOTS</button>
  <button id="reportBtn" onclick="openReport()" disabled>
    OPEN REPORT PAGE
  </button>
</div>

<div id="status"></div>
</div>

<div id="rawResults" style="display:none;"></div>

</div>

<script>
async function runSEO() {
  const urls = document.getElementById("urls").value
    .split("\n").map(u=>u.trim()).filter(Boolean);

  const raw = document.getElementById("rawResults");
  const status = document.getElementById("status");
  const reportBtn = document.getElementById("reportBtn");

  raw.innerHTML = "";
  reportBtn.disabled = true;

  for (let i=0;i<urls.length;i++) {
    status.textContent = `Processing ${i+1} / ${urls.length}`;

    const res = await fetch("/.netlify/functions/seo", {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({ url: urls[i] })
    });
    const d = await res.json();

    raw.innerHTML += `
<div class="report-item">
  <h3>${d.url}</h3>

  <div class="site-preview">
    <div class="preview-label">Site Preview</div>
    <iframe src="${d.url}"></iframe>
  </div>

  <table>
    <tr><th>Title</th><td>${esc(d.title)}</td></tr>
    <tr><th>Description</th><td>${esc(d.description)}</td></tr>
    <tr><th>Canonical</th><td>${d.canonical||"-"}</td></tr>
    <tr><th>AMP</th><td>${d.amphtml||"-"}</td></tr>
  </table>

  <strong>Robots.txt</strong>
  <div class="code-block">${d.robots?.found ? esc(d.robots.content) : "robots.txt not found"}</div>

  <strong>Sitemap.xml</strong>
  <div class="code-block">${d.sitemap?.found ? esc(d.sitemap.content) : "sitemap.xml not found"}</div>
</div>`;
  }

  status.textContent = "Done.";
  reportBtn.disabled = false;
}

function openReport() {
  const content = document.getElementById("rawResults").innerHTML;

  const win = window.open("", "_blank");
  win.document.write(`
<!DOCTYPE html>
<html>
<head>
<title>SEO Report</title>
${document.querySelector("style").outerHTML}
</head>
<body>
<div class="container">
  <div class="report-toolbar">
    <h2>SEO Report</h2>
    <button onclick="window.print()">Save as PDF</button>
  </div>

  <div class="report-grid">
    ${content}
  </div>
</div>
</body>
</html>
`);
  win.document.close();
}

const esc = s =>
  (s||"").replace(/[&<>"']/g,m=>({
    "&":"&amp;","<":"&lt;",">":"&gt;",
    '"':"&quot;","'":"&#039;"
  }[m]));
</script>

</body>
</html>
