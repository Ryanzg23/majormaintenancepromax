<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MAJOR MAINTENANCE PRO MAX</title>
<link href="favicon.png" rel="shortcut icon" type="image/x-icon">

<style>
:root{
  --bg:#f5f5f5;
  --card:#fff;
  --text:#111;
  --btn:#2563eb;
  --border:#ddd;
  --code:#0f172a;
  --codeText:#e5e7eb;
}
[data-theme="dark"]{
  --bg:#020617;
  --card:#020617;
  --text:#e5e7eb;
  --btn:#38bdf8;
  --border:#1e293b;
  --code:#020617;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:var(--bg);
  color:var(--text);
}
.container{max-width:1200px;margin:auto;padding:16px}
header{display:flex;justify-content:space-between;align-items:center}
textarea{
  width:100%;
  min-height:160px;
  padding:12px;
  border-radius:8px;
  border:1px solid var(--border);
}
button,a.btn{
  background:var(--btn);
  color:#fff;
  border:none;
  border-radius:8px;
  padding:10px 14px;
  font-weight:600;
  cursor:pointer;
}
.actions{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-top:10px;
}
.actions button{flex:1 1 200px}
.card{
  background:var(--card);
  padding:16px;
  border-radius:12px;
}
#results{margin-top:20px}
.domain-card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:12px;
  padding:16px;
  margin-top:20px;
}
.domain-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.site-preview{
  position:relative;
  margin:12px 0;
}
.site-preview iframe{
  width:100%;
  height:260px;
  border-radius:8px;
  border:1px solid var(--border);
}
.preview-label{
  position:absolute;
  top:8px;
  left:8px;
  background:#000;
  color:#fff;
  padding:4px 8px;
  border-radius:6px;
  font-size:12px;
}
table{
  width:100%;
  border-collapse:collapse;
  font-size:12px;
}
th,td{
  border:1px solid var(--border);
  padding:6px;
}
.preview{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
  margin-top:10px;
}
.code-block{
  background:var(--code);
  color:var(--codeText);
  padding:10px;
  border-radius:8px;
  font-size:11px;
  max-height:220px;
  overflow:auto;
}
@media(max-width:800px){
  .preview{grid-template-columns:1fr}
}
</style>
</head>

<body data-theme="light">
<div class="container">

<header>
  <h1>MAJOR MAINTENANCE PRO MAX</h1>
  <button id="themeBtn" onclick="toggleTheme()">‚òÄÔ∏è Light</button>
</header>

<div class="card">
<textarea id="urls" placeholder="One URL per line"></textarea>

<div class="actions">
  <button onclick="ampTestAll()">AMP TEST ALL</button>
  <button onclick="pageSpeedAll()">PAGE SPEED ALL</button>
  <button onclick="scanAll()">SCAN ALL</button>
  <button onclick="cssCheckAll()">CHECK ALL CSS</button>
  <button onclick="runSEO()">GENERATE META + ROBOTS</button>
  <button id="reportBtn" onclick="openReport()" disabled>OPEN REPORT PAGE</button>
  <button id="exportBtn" onclick="exportReportHTML()" disabled>EXPORT REPORT (HTML)</button>
</div>

<div id="status"></div>
</div>

<div id="results"></div>

</div>

<script>
const getUrls=()=>urls.value.split("\n").map(u=>u.trim()).filter(Boolean);
const esc=s=>(s||"").replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;"}[m]));

function ampTestAll(){getUrls().forEach(u=>window.open(`https://search.google.com/test/amp?url=${u}`))}
function pageSpeedAll(){getUrls().forEach(u=>window.open(`https://pagespeed.web.dev/report?url=${u}`))}
function scanAll(){getUrls().forEach(u=>window.open(`https://sitecheck.sucuri.net/results/${u}`))}
function cssCheckAll(){getUrls().forEach(u=>window.open(`https://jigsaw.w3.org/css-validator/validator?uri=${u}`))}

async function runSEO(){
  results.innerHTML="";
  reportBtn.disabled=true;
  exportBtn.disabled=true;
  const urls=getUrls();
  for(let i=0;i<urls.length;i++){
    status.textContent=`Processing ${i+1}/${urls.length}`;
    const res=await fetch("/.netlify/functions/seo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:urls[i]})});
    const d=await res.json();

    results.innerHTML+=`
<div class="domain-card">
  <div class="domain-header">
    <strong>${esc(d.url)}</strong>
    <div>
      <button onclick="togglePreview(this)">Hide Preview</button>
      <a class="btn" href="${d.finalUrl}" target="_blank">Visit ‚Üó</a>
    </div>
  </div>

  <div class="site-preview">
    <div class="preview-label">Site Preview</div>
    <iframe src="${d.finalUrl}"></iframe>
  </div>

  <table>
    <tr><th>Title</th><td>${esc(d.title)}</td></tr>
    <tr><th>Description</th><td>${esc(d.description)}</td></tr>
    <tr><th>Canonical</th><td>${d.canonical||"-"}</td></tr>
    <tr><th>AMP</th><td>${d.amphtml||"-"}</td></tr>
  </table>

  <div class="preview">
    <div>
      <strong>Robots.txt</strong>
      <div class="code-block">${d.robots?.found?esc(d.robots.content):"robots.txt not found"}</div>
    </div>
    <div>
      <strong>Sitemap.xml</strong>
      <div class="code-block">${d.sitemap?.found?esc(d.sitemap.content):"sitemap.xml not found"}</div>
    </div>
  </div>
</div>`;
  }
  status.textContent="Done.";
  reportBtn.disabled=false;
  exportBtn.disabled=false;
}

function togglePreview(btn){
  const p=btn.closest(".domain-card").querySelector(".site-preview");
  p.style.display=p.style.display==="none"?"":"none";
  btn.textContent=p.style.display==="none"?"Show Preview":"Hide Preview";
}

function toggleTheme(){
  document.body.dataset.theme=document.body.dataset.theme==="light"?"dark":"light";
  themeBtn.textContent=document.body.dataset.theme==="light"?"‚òÄÔ∏è Light":"üåô Dark";
}

function buildReportHTML(){
  return `<!DOCTYPE html><html><head><meta charset="UTF-8"><title>SEO Report</title>${document.querySelector("style").outerHTML}</head>
<body><div class="container"><h2>SEO Report</h2>${results.innerHTML}</div></body></html>`;
}
function openReport(){const w=window.open("");w.document.write(buildReportHTML());w.document.close();}
function exportReportHTML(){
  const blob=new Blob([buildReportHTML()],{type:"text/html"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="seo-report.html";
  a.click();
}
</script>
</body>
</html>
