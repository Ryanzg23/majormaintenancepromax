<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SEO Bulk Checker</title>

<style>
:root {
  --bg:#f5f5f5;
  --text:#111;
  --card:#fff;
  --btn:#2563eb;
  --btn-text:#fff;
  --border:#ddd;

  --rowA:#ffffff;
  --rowB:#f0f4ff;
}

[data-theme="dark"] {
  --bg:#0f172a;
  --text:#e5e7eb;
  --card:#020617;
  --btn:#38bdf8;
  --btn-text:#020617;
  --border:#1e293b;

  --rowA:#020617;
  --rowB:#0b1224;
}

body {
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,sans-serif;
}

.container {
  max-width:1400px;
  margin:auto;
  padding:20px;
}

header {
  display:flex;
  justify-content:space-between;
  align-items:center;
}

textarea {
  width:100%;
  height:160px;
  padding:12px;
  border-radius:8px;
  border:1px solid var(--border);
}

button {
  padding:10px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  background:var(--btn);
  color:var(--btn-text);
  font-weight:600;
}

.card {
  background:var(--card);
  padding:15px;
  border-radius:10px;
  margin-top:15px;
}

.actions {
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-top:10px;
}

.actions button {
  flex:1 1 220px;
}

table {
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
  font-size:13px;
}

th, td {
  border:1px solid var(--border);
  padding:8px;
  vertical-align:top;
}

th {
  background:rgba(0,0,0,.05);
}

.domain-a td {
  background:var(--rowA);
}

.domain-b td {
  background:var(--rowB);
}

.preview {
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:15px;
}

.preview h4 {
  margin:0 0 5px 0;
  font-size:13px;
}

pre {
  white-space:pre-wrap;
  max-height:220px;
  overflow:auto;
  font-size:12px;
  background:rgba(0,0,0,.05);
  padding:8px;
  border-radius:6px;
}

.status {
  margin-top:10px;
  font-size:13px;
  opacity:.7;
}

@media (max-width: 900px) {
  .preview {
    grid-template-columns:1fr;
  }
}
</style>
</head>

<body data-theme="light">
<div class="container">

<header>
  <h2>SEO Bulk Checker</h2>
  <button onclick="toggleTheme()">ðŸŒ™ Theme</button>
</header>

<div class="card">
<textarea id="urls" placeholder="One domain or URL per line"></textarea>

<div class="actions">
  <button onclick="ampTestAll()">AMP TEST ALL</button>
  <button onclick="pageSpeedAll()">PAGE SPEED ALL</button>
  <button onclick="scanAll()">SCAN ALL</button>
  <button onclick="cssCheckAll()">CHECK ALL CSS</button>
  <button onclick="runSEO()">GENERATE META + ROBOTS</button>
</div>

<div class="status" id="status"></div>
</div>

<div class="card">
<table>
<thead>
<tr>
  <th>URL</th>
  <th>Title</th>
  <th>Description</th>
  <th>Canonical</th>
  <th>AMP</th>
</tr>
</thead>
<tbody id="results"></tbody>
</table>
</div>

</div>

<script>
const getUrls = () =>
  document.getElementById("urls").value
    .split("\n")
    .map(u => u.trim())
    .filter(Boolean);

const openWithDelay = (urls, builder, delay=700) =>
  urls.forEach((u,i)=>setTimeout(()=>window.open(builder(u),"_blank"),i*delay));

function ampTestAll(){openWithDelay(getUrls(),u=>`https://search.google.com/test/amp?url=${encodeURIComponent(u)}`)}
function pageSpeedAll(){openWithDelay(getUrls(),u=>`https://pagespeed.web.dev/report?url=${encodeURIComponent(u)}`)}
function scanAll(){openWithDelay(getUrls(),u=>`https://sitecheck.sucuri.net/results/${encodeURIComponent(u)}`)}
function cssCheckAll(){openWithDelay(getUrls(),u=>`https://jigsaw.w3.org/css-validator/validator?uri=${encodeURIComponent(u)}`)}

async function runSEO() {
  const urls = getUrls();
  const tbody = document.getElementById("results");
  const status = document.getElementById("status");
  tbody.innerHTML = "";

  for (let i=0;i<urls.length;i++) {
    status.textContent = `Processing ${i+1}/${urls.length}`;
    const res = await fetch("/.netlify/functions/seo", {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({ url: urls[i] })
    });
    const d = await res.json();

    const rowClass = i % 2 === 0 ? "domain-a" : "domain-b";

    tbody.innerHTML += `
<tr class="${rowClass}">
  <td>${d.url}</td>
  <td>${esc(d.title)}</td>
  <td>${esc(d.description)}</td>
  <td>${d.canonical || "-"}</td>
  <td>${d.amphtml || "-"}</td>
</tr>

<tr class="${rowClass}">
  <td colspan="5">
    <div class="preview">
      <div>
        <h4>Robots.txt (Status: ${d.robots.status || "N/A"})</h4>
        <pre>${esc(d.robots.content || "")}</pre>
      </div>
      <div>
        <h4>Sitemap.xml (Status: ${d.sitemap.status || "N/A"})</h4>
        <pre>${esc(d.sitemap.content || "")}</pre>
      </div>
    </div>
  </td>
</tr>`;
  }

  status.textContent = "Done.";
}

const esc = t => (t||"").replace(/[&<>"']/g,m=>({
  "&":"&amp;","<":"&lt;",">":"&gt;",
  '"':"&quot;","'":"&#039;"
}[m]));

const toggleTheme = () =>
  document.body.dataset.theme =
    document.body.dataset.theme === "light" ? "dark" : "light";
</script>

</body>
</html>
