<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Major Maintenance Pro Max</title>

<style>
:root {
  --bg:#f5f5f5;
  --text:#111;
  --card:#fff;
  --btn:#2563eb;
  --btn-text:#fff;
  --border:#ddd;
}
[data-theme="dark"] {
  --bg:#0f172a;
  --text:#e5e7eb;
  --card:#020617;
  --btn:#38bdf8;
  --btn-text:#020617;
  --border:#1e293b;
}
body {
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,sans-serif;
}
.container {
  max-width:1200px;
  margin:auto;
  padding:20px;
}
header {
  display:flex;
  justify-content:space-between;
  align-items:center;
}
textarea {
  width:100%;
  height:160px;
  padding:12px;
  border-radius:8px;
  border:1px solid var(--border);
}
button {
  padding:10px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  background:var(--btn);
  color:var(--btn-text);
  font-weight:600;
}
.card {
  background:var(--card);
  padding:15px;
  border-radius:10px;
  margin-top:15px;
}
.actions {
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-top:10px;
}
.actions button {
  flex:1 1 220px;
}
table {
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
  font-size:13px;
}
th,td {
  border:1px solid var(--border);
  padding:8px;
  vertical-align:top;
}
th {
  background:rgba(0,0,0,.05);
}
.status {
  margin-top:10px;
  font-size:13px;
  opacity:.7;
}
</style>
</head>

<body data-theme="light">
<div class="container">

<header>
  <h2>Major Maintenance Pro Max</h2>
  <button onclick="toggleTheme()">ðŸŒ™ Theme</button>
</header>

<div class="card">
<textarea id="urls" placeholder="One URL per line"></textarea>

<div class="actions">
  <button onclick="ampTestAll()">AMP TEST ALL</button>
  <button onclick="pageSpeedAll()">PAGE SPEED ALL</button>
  <button onclick="scanAll()">SCAN ALL</button>
  <button onclick="cssCheckAll()">CHECK ALL CSS</button>
  <button onclick="runSEO()">GENERATE META DATA</button>
</div>

<div class="status" id="status"></div>
</div>

<div class="card">
<table>
<thead>
<tr>
  <th>URL</th>
  <th>Title</th>
  <th>Description</th>
  <th>Canonical</th>
  <th>AMP HTML</th>
</tr>
</thead>
<tbody id="results"></tbody>
</table>
</div>

</div>

<script>
function getUrls() {
  return document.getElementById("urls").value
    .split("\n")
    .map(u => u.trim())
    .filter(Boolean);
}

/* ===== POPUP SAFE OPENER ===== */
function openWithDelay(urls, builder, delay=700) {
  urls.forEach((url,i)=>{
    setTimeout(()=>window.open(builder(url),"_blank"),i*delay);
  });
}

/* ===== BULK TOOLS ===== */
function ampTestAll() {
  openWithDelay(getUrls(),u =>
    `https://search.google.com/test/amp?url=${encodeURIComponent(u)}`
  );
}

function pageSpeedAll() {
  openWithDelay(getUrls(),u =>
    `https://pagespeed.web.dev/report?url=${encodeURIComponent(u)}`
  );
}

function scanAll() {
  openWithDelay(getUrls(),u =>
    `https://sitecheck.sucuri.net/results/${encodeURIComponent(u)}`
  );
}

function cssCheckAll() {
  openWithDelay(getUrls(),u =>
    `https://jigsaw.w3.org/css-validator/validator?uri=${encodeURIComponent(u)}`
  );
}

/* ===== SERVER-SIDE SEO ===== */
async function runSEO() {
  const urls = getUrls();
  const tbody = document.getElementById("results");
  const status = document.getElementById("status");
  tbody.innerHTML = "";

  for (let i = 0; i < urls.length; i++) {
    const url = urls[i];
    status.textContent = `Processing ${i + 1} / ${urls.length}`;

    try {
      const res = await fetch("/.netlify/functions/seo", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ url })
      });

      const d = await res.json();

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${d.url || url}</td>
        <td>${escape(d.title)}</td>
        <td>${escape(d.description)}</td>
        <td>${d.canonical || "-"}</td>
        <td>${d.amphtml || "-"}</td>
      `;
      tbody.appendChild(tr);

    } catch (e) {
      tbody.innerHTML += `
        <tr>
          <td>${d.url || url}</td>
          <td colspan="4">ERROR</td>
        </tr>`;
    }
  }

  status.textContent = "Done.";
}

function escape(t="") {
  return t.replace(/[&<>"']/g,m=>({
    "&":"&amp;","<":"&lt;",">":"&gt;",
    '"':"&quot;","'":"&#039;"
  }[m]));
}

function toggleTheme() {
  document.body.dataset.theme =
    document.body.dataset.theme === "light" ? "dark" : "light";
}
</script>

</body>
</html>


