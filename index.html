<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MAJOR MAINTENANCE PRO MAX</title>

<style>
*,
*::before,
*::after { box-sizing:border-box; }

:root {
  --bg:#f5f5f5;
  --text:#111;
  --card:#ffffff;
  --btn:#2563eb;
  --btn-text:#ffffff;
  --border:#ddd;

  --cardA:#ffffff;
  --cardB:#f1f5ff;

  --code-bg:#0f172a;
  --code-text:#e5e7eb;
}

[data-theme="dark"] {
  --bg:#0b1020;
  --text:#e5e7eb;
  --card:#020617;
  --btn:#38bdf8;
  --btn-text:#020617;
  --border:#1e293b;

  --cardA:#020617;
  --cardB:#0b1224;

  --code-bg:#020617;
  --code-text:#e5e7eb;
}

body {
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,sans-serif;
}

.container {
  max-width:1200px;
  margin:auto;
  padding:16px;
}

/* HEADER */
header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  flex-wrap:wrap;
}

h1 { margin:0; font-size:20px; }

/* INPUT */
textarea {
  width:100%;
  min-height:160px;
  padding:12px;
  border-radius:8px;
  border:1px solid var(--border);
  resize:vertical;
}

/* BUTTONS */
button, a.btn {
  padding:10px 14px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  background:var(--btn);
  color:var(--btn-text);
  font-weight:600;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:6px;
  font-size:13px;
  text-decoration:none;
  transition:.15s;
}

button:hover, a.btn:hover {
  transform:translateY(-1px);
  box-shadow:0 6px 18px rgba(0,0,0,.2);
}

/* CARD */
.card {
  background:var(--card);
  padding:15px;
  border-radius:12px;
  margin-top:15px;
}

.actions {
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-top:10px;
}

.actions button { flex:1 1 220px; }

/* DOMAIN CARD */
.domain-card {
  border-radius:14px;
  padding:16px;
  margin-top:22px;
  border:1px solid var(--border);
}

.domain-a { background:var(--cardA); }
.domain-b { background:var(--cardB); }

.domain-header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
  flex-wrap:wrap;
}

.domain-header h3 {
  margin:0;
  font-size:16px;
  word-break:break-all;
}

.domain-actions {
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}

/* SITE PREVIEW */
.site-preview {
  position:relative;
  margin:12px 0;
  resize:both;
  overflow:auto;
  min-height:220px;
  max-height:70vh;
}

.site-preview iframe {
  width:100%;
  height:100%;
  min-height:280px;
  border:1px solid var(--border);
  border-radius:10px;
}

.preview-label {
  position:absolute;
  top:10px;
  left:10px;
  background:rgba(0,0,0,.75);
  color:#fff;
  font-size:13px;
  font-weight:600;
  padding:6px 12px;
  border-radius:8px;
  z-index:2;
}

/* TABLE */
table {
  width:100%;
  border-collapse:collapse;
  font-size:13px;
}

thead th {
  background:rgba(0,0,0,.05);
  font-size:14px;
  text-align:center;
  padding:12px 8px;
}

td, th {
  border:1px solid var(--border);
  padding:10px;
}

/* ROBOTS / SITEMAP */
.preview {
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:15px;
  margin-top:15px;
}

.preview h4 { margin:0 0 6px; }

pre {
  background:var(--code-bg);
  color:var(--code-text);
  padding:12px;
  border-radius:10px;
  max-height:260px;
  overflow:auto;
  font-size:12px;
  white-space:pre-wrap;
  overflow-wrap:anywhere;
}

/* STATUS */
.status { margin-top:10px; font-size:13px; opacity:.7; }

/* ===================== */
/* PRINT / PDF STYLES    */
/* ===================== */
@media print {
  body { background:#fff; color:#000; }
  .page-break { page-break-before: always; break-before: page; }
  .pdf-preview iframe { height:520px; }
  pre { max-height:none !important; }
}

/* MOBILE */
@media (max-width:768px) {
  .actions button { flex:1 1 100%; }
  .preview { grid-template-columns:1fr; }
  .site-preview { resize:none; }
}
</style>
</head>

<body data-theme="light">
<div class="container">

<header>
  <h1>MAJOR MAINTENANCE PRO MAX</h1>
  <button onclick="toggleTheme()">☀️ Light</button>
</header>

<div class="card">
<textarea id="urls" placeholder="One domain or URL per line"></textarea>

<div class="actions">
  <button onclick="ampTestAll()">AMP TEST ALL</button>
  <button onclick="pageSpeedAll()">PAGE SPEED ALL</button>
  <button onclick="scanAll()">SCAN ALL</button>
  <button onclick="cssCheckAll()">CHECK ALL CSS</button>
  <button onclick="runSEO()">GENERATE META + ROBOTS</button>
  <button onclick="generatePDFReport()">GENERATE PDF REPORT</button>
</div>

<div class="status" id="status"></div>
</div>

<div id="results"></div>

</div>

<script>
const getUrls = () =>
  document.getElementById("urls").value
    .split("\n")
    .map(u => u.trim())
    .filter(Boolean);

const openWithDelay = (urls, builder, delay=700) =>
  urls.forEach((u,i)=>setTimeout(()=>window.open(builder(u),"_blank"),i*delay));

function ampTestAll(){openWithDelay(getUrls(),u=>`https://search.google.com/test/amp?url=${encodeURIComponent(u)}`)}
function pageSpeedAll(){openWithDelay(getUrls(),u=>`https://pagespeed.web.dev/report?url=${encodeURIComponent(u)}`)}
function scanAll(){openWithDelay(getUrls(),u=>`https://sitecheck.sucuri.net/results/${encodeURIComponent(u)}`)}
function cssCheckAll(){openWithDelay(getUrls(),u=>`https://jigsaw.w3.org/css-validator/validator?uri=${encodeURIComponent(u)}`)}

async function runSEO() {
  const urls = getUrls();
  const out = document.getElementById("results");
  out.innerHTML = "";
  for (let i=0;i<urls.length;i++) {
    const res = await fetch("/.netlify/functions/seo", {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({ url: urls[i] })
    });
    const d = await res.json();
    const cls = i % 2 ? "domain-b" : "domain-a";

    out.innerHTML += `
<div class="domain-card ${cls}">
  <div class="domain-header">
    <h3>${d.url}</h3>
    <div class="domain-actions">
      <a class="btn" href="${d.url}" target="_blank">Visit Site ↗</a>
    </div>
  </div>

  <div class="site-preview">
    <div class="preview-label">Site Preview</div>
    <iframe src="${d.url}"></iframe>
  </div>

  <table>
    <thead><tr><th>Title</th><th>Description</th><th>Canonical</th><th>AMP</th></tr></thead>
    <tbody><tr>
      <td>${esc(d.title)}</td>
      <td>${esc(d.description)}</td>
      <td>${d.canonical||"-"}</td>
      <td>${d.amphtml||"-"}</td>
    </tr></tbody>
  </table>

  <div class="preview">
    <div>
      <h4>Robots.txt</h4>
      <pre>${d.robots?.found ? esc(d.robots.content) : "robots.txt not found"}</pre>
    </div>
    <div>
      <h4>Sitemap.xml</h4>
      <pre>${d.sitemap?.found ? esc(d.sitemap.content) : "sitemap.xml not found"}</pre>
    </div>
  </div>
</div>`;
  }
}

function generatePDFReport() {
  const cards = document.querySelectorAll(".domain-card");
  if (!cards.length) return alert("No results to export");

  let html = `
<!DOCTYPE html><html><head><meta charset="UTF-8">
<title>SEO PDF Report</title>
<style>
body{font-family:system-ui;margin:0;color:#000}
h2{margin:0 0 6px}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:8px}
pre{background:#f5f5f5;padding:10px;white-space:pre-wrap}
.page-break{page-break-before:always}
iframe{width:100%;height:520px;border:1px solid #ccc}
</style></head><body>
`;

  cards.forEach((c,i)=>{
    html += `<h2>${c.querySelector("h3").innerText}</h2>`;
    html += c.querySelector(".site-preview").outerHTML;
    html += c.querySelector("table").outerHTML;
    html += c.querySelector(".preview").outerHTML;
    if(i<cards.length-1) html += `<div class="page-break"></div>`;
  });

  html += `<script>window.onload=()=>setTimeout(()=>window.print(),300)<\/script></body></html>`;
  const w = window.open("");
  w.document.write(html);
  w.document.close();
}

const esc = s => (s||"").replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"}[m]));

function toggleTheme(){
  document.body.dataset.theme =
    document.body.dataset.theme === "dark" ? "light" : "dark";
}
</script>

</body>
</html>
